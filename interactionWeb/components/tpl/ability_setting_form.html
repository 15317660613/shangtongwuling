<!--
File   : system_user_tpl_add_edit.html
Created: Tuesday September 18th 2018 11:22:10 am
Author : yuchunyu97
License: MIT License

Copyright (c) 2018 yuchunyu97

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-----
Last Modified: Tuesday September 25th 2018 3:51:12 pm
Modified By  : yuchunyu97 at <yuchunyu97@gmail.com>
-----
Description:
-----
HISTORY:
-->
<style>
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
    }
    
    input[] {
        -moz-appearance: textfield;
    }
    
    #setting-form .layui-input,
    .layui-select,
    .xm-select-parent {
        width: 210px;
    }
    
    #setting-form .xm-select-label span {
        max-width: 140px;
        white-space: nowrap;
    }
    
    #setting-form .xm-select-label span font {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>
<div class="layui-tpl-container layui-form" style="padding-bottom: 60px;" id="setting-form">
    <div class="layui-row">
        <div class="layui-col-md4">
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span> 零件号</label>
                <div class="layui-input-block">
                    <select name="partsCode" id="partsCode " placeholder="选择零件号" xm-select="partsCode" xm-select-skin="normal" xm-select-direction="down" xm-select-search xm-select-radio="" lay-verify="required">
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span>控制图类型</label>
                <div class="layui-input-block">
                    <select name="chartType" id="chartType_select" placeholder="选择零件号" xm-select="chartType_select" xm-select-skin="normal" xm-select-direction="down" xm-select-search xm-select-radio="" lay-verify="required">
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span>样本数</label>
                <div class="layui-input-block">
                    <input id="sampleSize" name="sampleSize" placeholder="请输入" class="layui-input input-disabled" lay-verify="validTen" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span>上限值</label>
                <div class="layui-input-block">
                    <input name="thresholdMax" id="thresholdMax" placeholder="请输入" class="layui-input" lay-verify="validNumber" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span>X上控制线</label>
                <div class="layui-input-block">
                    <input name="xucl" placeholder="请输入" class="layui-input" lay-verify="validNumber" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 105px;padding: 5px 0px;"><span style="color: red;">*</span>Rs/Rm上控制线</label>
                <div class="layui-input-block">
                    <input name="ucl" placeholder="请输入" class="layui-input" lay-verify="validNumber" autocomplete="off">
                </div>
            </div>
        </div>

        <div class="layui-col-md4 ">
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span>零件名称</label>
                <div class="layui-input-block">
                    <select name="partsName" id="partsName " placeholder="选择名称" xm-select="partsName" xm-select-skin="normal" xm-select-direction="down" xm-select-radio="" xm-select-search lay-verify="required" xm-select-height="36px">
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span>特性名称</label>
                <div class="layui-input-block">
                    <input type="text" name="characterName" placeholder="请输入" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span>公差类型</label>
                <div class="layui-input-block">
                    <select name="toleranceType" id="toleranceType_select" placeholder="请选择" xm-select="toleranceType_select" xm-select-skin="normal" xm-select-direction="down" xm-select-search xm-select-radio="" lay-verify="required">
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span>标准值</label>
                <div class="layui-input-block">
                    <input name="thresholdStandard" placeholder="请输入" class="layui-input" lay-verify="validNumber" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span>X中心线</label>
                <div class="layui-input-block">
                    <input name="xcenterLine" placeholder="请输入" class="layui-input" lay-verify="validNumber" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 105px;padding: 5px 0px;"><span style="color: red;">*</span>Rs/Rm下控制线</label>
                <div class="layui-input-block">
                    <input name="lcl" placeholder="请输入" class="layui-input" lay-verify="validNumber" autocomplete="off">
                </div>
            </div>
        </div>

        <div class="layui-col-md4">
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span>车型/机型</label>
                <div class="layui-input-block">
                    <input type="text" name="carType" placeholder="请输入" class="layui-input" disabled>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 104px;padding: 5px 0;"><span style="color: red;">*</span>控制计划版本号</label>
                <div class="layui-input-block">
                    <input name="planVersion" placeholder="版本号" class="layui-input" lay-verify="required" maxlength="50" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"></label>
                <div class="layui-input-block">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span>下限值</label>
                <div class="layui-input-block">
                    <input name="thresholdMin" id="thresholdMin" placeholder="请输入" class="layui-input" lay-verify="validNumber" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color: red;">*</span>X下控制线</label>
                <div class="layui-input-block">
                    <input name="xlcl" placeholder="请输入" class="layui-input" lay-verify="validNumber" autocomplete="off">
                </div>
            </div>
        </div>
    </div>
    <input type="text" name="handleType" id="handleType" style="display: none;">
    <input type="text" name="id" id="id" style="display: none;">
    <!-- 提交按钮 -->
    <!-- 取消按钮 -->
    <div class="layui-form-item" style="text-align: center;position: absolute;bottom: 0;left: 0;right: 0;">
        <button class="layui-btn layui-btn-normal" lay-submit lay-filter="menuSave">保存</button>
        <button class="layui-btn layui-btn-primary" id="menuCancle">取消</button>
    </div>

</div>


</div>
</div>
<script>
    layui.use(['form', 'layer'], function() {
        var form = layui.form,
            layer = layui.layer,
            admin = layui.admin;
        //自定义验证规则
        form.verify({
            validNumber: function(value) {

                if (value == '') {
                    return '必填项不能为空'
                }
                if (isNaN(value) || value.indexOf('e') != -1) {
                    return '不是合法数字';
                }
                if (value - 0 > 100000000) {
                    return '最大值不能超过10000000';
                }
                if (value.indexOf(".") != -1 && value.substring(value.indexOf(".") + 1, value.length).length > 10) {

                    return '小数点后不能超过十位'
                }

            },
            validIntNumber: function(value) {
                if (value == '') {
                    return '必填项不能为空'
                }
                if (value - 0 < 0) {
                    return '请输入正整数'
                }

                if (value.indexOf(".") != -1) {

                    return '请输入整数'
                }

            },

            validTen: function(value) {
                if (value == '') {
                    return '必填项不能为空'
                }
                if (value - 0 > 9 || value - 0 < 2 || isNaN(value)) {
                    return '请输入2~9的整数'
                }

                if (value.indexOf(".") != -1) {

                    return '请输入十以内整数'
                }

            },
        });


        form.on('submit(menuSave)', function(obj) {
            //页面显示NA，数据库只能存数据，存储-1
            if("NA" == obj.field.thresholdMax){
                obj.field.thresholdMax = -1;
            }
            if("NA" == obj.field.thresholdMin){
                obj.field.thresholdMin = -1;
            }
            var data = obj.field,
                elem = data.elem;
            // var ajaxType = 'post';
            // if (data.handleType == 'edit') {
            //     ajaxType = 'put';
            // }
            delete data.handleType;
            admin.req("/api-edu/interaction/abilitysetting/parts-character/uniqueness?partsCode=" + data.partsCode + "&charaName=" + data.characterName, {}, function(res) {
                if (res.ok) {
                    if (res.data) {
                        admin.req('/api-edu/interaction/abilitysetting', data, function(data) {
                            if (data.ok) {
                                layer.msg('保存成功！', {
                                    icon: 1
                                });
                                admin.finishPopupCenter();
                            } else {
                                return layer.msg('保存失败：' + data.message, {
                                    icon: 5
                                });
                                admin.finishPopupCenter();
                            }
                        }, {
                            method: 'post'
                        });
                    } else {
                        layer.confirm('零件号+特性名称已存在，是否进行更新覆盖?', {
                            icon: 3,
                            title: '提示'
                        }, function(index) {
                            //do something
                            admin.req('/api-edu/interaction/abilitysetting', data, function(data) {
                                if (data.ok) {
                                    layer.msg('保存成功！', {
                                        icon: 1
                                    });
                                    admin.finishPopupCenter();
                                } else {
                                    return layer.msg('保存失败：' + data.message, {
                                        icon: 5
                                    });
                                    admin.finishPopupCenter();
                                }
                            }, {
                                method: 'post'
                            });
                            layer.close(index);
                        })
                    }
                } else {
                    layer.msg(res.message)
                }
            })
        });
        /*
           取消
         */
        $('#menuCancle').on('click', function() {
            admin.closePopupCenter();
        });

        // $('input[type=number]').keypress(function(e) {
        //     debugger
        //     if (!String.fromCharCode(e.keyCode).match(/[0-9\.]/)) {
        //         return false;
        //     }
        // });

    })
</script>